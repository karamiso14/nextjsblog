---
title: "良いコード/悪いコードで学ぶ設計入門"
date: "2022-10-07"
---

途中からだけど読んだことをメモっておく

## 13章 モデリング

**特定の目的達成のために最低限考慮が必要な要素を備えたもの**がモデル

商品なら、注文時と配送時で必要な情報が異なる  
注文時には在庫数、配送時に重量とか

クラス設計時にモデル(UML)を作成する作業フローを想定している  
実装を進める中で修正点があればモデルにフィードバックすることで資料としての価値が出てくる  

基本的にはユースケースでユーザの視点から考える  
ただ処理に必要な要素だけでなく、法的視点など様々な観点からモデルを見る  

>本質的課題を解決し、機能性の革新に貢献するモデルをドメイン駆動設計では**深いモデル**と呼びます

詳細は17章のドメイン駆動設計までお預け

モデリングに対しての考え方の事始めという感じ  
実際もっとシステム設計よりの情報とか、システム設計に限らないモデリングの仕方とかを調べてもいいかもしれない  
特に図解やツールについては即使えそうな感じするので調べること候補に入れておく

## 14章 リファクタリング

基本的なことから始まる。リーダブルコード思い出す

- if早期リターン
- !isEnableをisDisable()実装で論理否定減らす
- comic.point > user.point みたいなのをifに直接かかず関数化する

実際のプロダクトコードはもっと複雑、どうすればよいか？

- ユニットテスト
  - 鉄板。
- ファーストクラスコレクション
  - 複雑性の排除目的？
  - Partyクラスの中にmemberListがあって、addとかのメソッドがクラスにまとまっているやつ
- staticメソッドを使わない
  - staticにするとデータ側とメソッドが別クラスに分離しがちだから(多分)
- TDD(だと思うけど明言なし)
  - 仕様がわかっている場合。
  - 仕様がわからない時は
    - 仕様分析方法1-仕様化テスト
      - いろんな引数突っ込んで仕様を探る方法。泥沼。
    - 仕様分析方法2-試行リファクタリング
      - 試しにリポジトリクローンしてリファクタシてみると理解が深まるよ。泥沼。
- IDE機能 例はInteliJ
  - Refactor→Extract Methodマジ便利そう。多分stormにもある。

リファクタリングと機能追加はかならずどちらか一方でやること  
コミットも分けること。原因究明しづらい。  
コミットは違いがわかる単位で。

リスコフの置換原則 基本型を継承型に置き換えても動作できなければならない  
interface切り替えてもちゃんと動くこと。instanceofで分岐とかしてたら意味ない。  
interfaceについては6章を読み直しとくこと。

## 15章 設計の意義と設計への向き合い方

なぜ設計が必要か。設計とは何なのか。みたいな話

- 木こりのジレンマ
- 設計力＝技術力＝資産
- レガシーコード、技術的負債

課題を解決するには、課題を認識しないといけない  
ソフトウェア価値のマトリックス

|                | 見える | 見えない       |
| -------------- | ------ | -------------- |
| プラスの価値   | 新機能 | アーキテクチャ |
| マイナスの価値 | バグ   | 技術的負債     |

理想の形を知ることではじめてズレや間違いに気づく

コードメトリクス、ソフトウェアメトリクスを活用する  
メソッドは10行、クラスは100行で収まるらしい。マジかよ。

クラス分割で読みにくくなるのではーみたいなのは、ひとつひとつが正常に動作することを信じきれてないから、らしい  
テストが書ければなぁ……

循環的複雑度(最クロマティック複雑度)  
よく言われるやつ。ネストが多いとあがる

凝集度  
モジュール内におけるデータとロジックの関係性の強さ  
クラスのインスタンス変数とそれを扱うメソッドが同じクラスにあるか？みたいな観点  
LCOM(Lack of Cohesion in Methods)という指標がある  
具体的にモジュールってどの範囲？

結合度  
モジュール間の依存度合い  
影響範囲のデカさ  
分析ツール使わなくても、クラス図描いたりで見えやすい

チャンク  
マジカルナンバー4の話  
短期記憶に覚えられる数字は4プラマイ1ぐらいというやつ  
確かにメソッド10行ぐらいまで絞れるなら、ぱっと見ですべてが見えるだろうけど……

パレートの法則とコアドメイン  
売上の80%は20%の領域が持ってる、選択と集中の話  
全部にテストは書けないし、なんでもリファクタすればいいってもんじゃないよということ

## 16章 設計を妨げる開発プロセスとの戦い

コンウェイの法則  
3チームで作ると３つに分かれた仕組みができやすい、みたいな  
完成図から逆算してチームを作る逆コンウェイ作戦というのもあるが  
いまいちらしい

心理的安全性については割愛

書籍 Clean Architectureいわく  
TDDのほうが将来的に早い。とのこと。

クラス図などの資料を用意をしてから設計、実装する。  
資料にフィードバックを繰り返して品質を高める。  
そのためにも資料無しでいきなり設計始めるのは良くないよ的なこと  
一発で正解の設計を出すのは難しい。

早すぎる最適化アンチパターン  
必要ないのに高速化を意識して複雑化させたりすること

- 割れ窓理論 汚いコードを放置すると治安が悪化する
- 既存のコードを疑う。アンカリング効果を意識？最初に見たものが基準になってしまう
- ジョシュアツリーの法則。名前を知らないと存在を知覚できないとする認知法則。
  - 色々知っていけば自ずと見える範囲も広がるぞという話。生焼けオブジェクトとか

改めて責務を特定する手順とか考え方を見たほうがよいかも

クープマン目標値  
10.9%を超えると影響力が出始めるらしい  
元は軍事理論であるランチェスターの法則、を応用したマーケットシェア理論、の中にあるクープマン目標値、の影響目標値。長い

フォローアップ勉強会  

1. 本に書かれているノウハウを１，２個程度読み合わせる
2. ノウハウを適用できそうな箇所を、プロダクションコードの中から探す。普段から触っているコードはとっつきやすい
3. ノウハウを使ってコードを改善してみる
4. before、afterがわかるように発表する
5. 発表内容に注意手質疑応答や議論をする

読んで終わり、にならないようにするのが大事そう
