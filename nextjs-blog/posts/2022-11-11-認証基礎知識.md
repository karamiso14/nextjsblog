---
title: 認証学び直し
date: "2022-11-11"
---

## 認証について

開発チーム内で名称がバラついてて困ったのでまとめなおしておく

## セッション認証

- セッションベースともいう
- ステートフル(前回通信の状態を保持)
- cokkieにセッション情報を保存する
- 毎回通信のたびにセッション情報を送る(ヘッダに入ってる？)
- セッションIDとサーバのデータを紐づけてサーバが管理する手間がある
- HTTPSの時だけ送るオプションがある(Set-Cookie secure)
- ブラウザを閉じると基本消える

初回にサーバからセッションIDを発行し、ブラウザがクッキーに保存  
このときSet-Cookieフィールドで送るので保存される
2回目からはCookieフィールドで送られてくるので、サーバ側の紐づけ情報と比較して認証する

## トークン認証

- トークンベースともいう
- ステートレス(前回通信の状態を保持しない)
- JWT(Json Web Token)という方式が一般的
  - ヘッダ、ペイロード、署名で構成
  - .が２つだったり４つだったりする（JWEかJWSか)
- サーバ側で秘密鍵を使ってJWTを作る
- クライアントはトークンを送りつけ、サーバは秘密鍵でuser_idを取り出す

大体やってることは一緒で、DBに保存するかしないかの違い？
DBに保存しなければWebサーバを増やすだけでスケールアウトできそう
DBはおいそれと増やせないのでスケールアップで耐える感じになる

Authorization HTTPのヘッダかなんかにある？そこにtoken入れるらしい

## アプリの場合

アプリってブラウザじゃないからcookieとかあんの？ってあたりを調べる。

どうも名称がとっちらかっている印象。

- 普段やってるのはステートレスなのでセッションベース
- だけどセッションを使っているかというと怪しい？独自実装？
  - クライアントからUUIDを受け取り、それをベースにuser_idをひもづけ
  - おそらく毎回UUIDを送りつけてもらっていて、それベースに進行させてる？
  - 実際はUUIDから別途なにかキーを生成して渡してそう
  - これをアクセストークンって呼んだりしてるせいで、セッションとトークンがとっちらかっている
    - [そのIDTokenの正体はセッショントークン？それともアサーション？ - r-weblife](https://ritou.hatenablog.com/entry/2020/01/08/070000)
    - 多分同じことを言っている……はず
